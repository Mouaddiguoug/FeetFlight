{"version":3,"sources":["../../src/controllers/users.controller.ts"],"sourcesContent":["import { NextFunction, Request, Response } from 'express';\nimport { CreateUserDto } from '@dtos/users.dto';\nimport { User } from '@interfaces/users.interface';\nimport userService from '@services/users.service';\n\nclass UsersController {\n  public userService = new userService();\n\n  public getUsers = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const findAllUsersData: User[] = await this.userService.findAllUser();\n\n      res.status(200).json({ data: findAllUsersData, message: 'findAll' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public getUserById = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const findOneUserData = await this.userService.findUserById(userId);\n\n      res.status(200).json(findOneUserData);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public generateAiPictures = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const color = req.body.color;\n      const category = req.body.category;\n\n      const generatedPictures = await this.userService.generateAiPictures(color, category);\n      \n\n      res.status(200).json(generatedPictures);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public checkForSale = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const postId = String(req.params.postId);\n      const userId = String(req.params.userId);\n      const plan = String(req.params.plan);\n      const checkedFOrSale = await this.userService.checkForSale(userId, postId);\n      const checkForSubscription = await this.userService.checkForSubscriptionbyUserId(userId, postId, plan);\n\n      console.log(checkForSubscription);\n      res.status(200).json(checkedFOrSale || checkForSubscription);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public getSellerPlans = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const sellerPlans = await this.userService.getSellerPlans(userId);\n\n      res.status(200).json({ data: sellerPlans });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public changePassword = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const email = String(req.params.email);\n      const userData = req.body;\n      const findOneUserData = await this.userService.changePassword(email, userData);\n\n      res.status(200).json({ data: findOneUserData, message: 'findOne' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public emailConfirming = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const token = String(req.params.token);\n      const confirmed = await this.userService.emailConfirming(token);\n\n      res.status(201).redirect(\"/\");\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public buyPost = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const saleData = req.body;\n\n      const boughtPost = await this.userService.buyPosts(userId, saleData);\n\n      res.status(200).json({ url: boughtPost });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public subscribe = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const subscriptionData = req.body;\n\n      const subscribeSssion = await this.userService.subscribe(userId, subscriptionData);\n\n      res.status(200).json(subscribeSssion);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public generateOtp = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const email = String(req.params.email);\n\n      const generatedHash = await this.userService.generateOtp(email);\n\n      res.status(200).json(generatedHash);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public verifyOtp = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const email = String(req.params.email);\n      const otpSettings = req.body;\n\n      const result: any = await this.userService.verifyOtp(otpSettings, email);\n\n      res.status(result.message == \"success\" ? 200 : 400).json(result);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public cancelSubscription = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n\n    try {\n      const userId = String(req.params.id);\n      const sellerId = String(req.params.sellerId);\n\n      const canceledSubscription = await this.userService.cancelSubscription(userId, sellerId);\n\n      res.status(200).json({ canceledSubscription: canceledSubscription });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public checkForSubscribtion = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const postId = req.body.data.postId;\n\n      const isSubscribed = await this.userService.checkForSubscription(userId, postId);\n\n      res.status(200).json({ data: isSubscribed });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public updateUser = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n\n      const userData: CreateUserDto = req.body;\n      const updateUserData: User[] = await this.userService.updateUser(userId, userData);\n\n      res.status(200).json({ data: updateUserData, message: 'updated' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public uploadDeviceToken = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const token = req.body.token;\n      await this.userService.uploadDeviceToken(userId, token);\n\n      res.status(200).json({ message: 'token uploaded succcessfully' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public desactivateUser = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = Number(req.params.id);\n      const desactivatedUser = await this.userService.desactivateUser(userId);\n\n      res.status(200).json({ data: desactivatedUser });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public uploadAvatar = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n\n      const avatarData = req.file;\n\n      await this.userService.uploadAvatar(avatarData, userId);\n\n      res.status(201).json({ messazge: \"avatar has been uploaded successfully\" });\n    } catch (error) {\n      next(error);\n    }\n  };\n}\n\nexport default UsersController;\n"],"names":["UsersController","userService","getUsers","req","res","next","findAllUsersData","findAllUser","status","json","data","message","error","getUserById","userId","String","params","id","findOneUserData","findUserById","generateAiPictures","color","body","category","generatedPictures","checkForSale","postId","plan","checkedFOrSale","checkForSubscription","checkForSubscriptionbyUserId","console","log","getSellerPlans","sellerPlans","changePassword","email","userData","emailConfirming","token","confirmed","redirect","buyPost","saleData","boughtPost","buyPosts","url","subscribe","subscriptionData","subscribeSssion","generateOtp","generatedHash","verifyOtp","otpSettings","result","cancelSubscription","sellerId","canceledSubscription","checkForSubscribtion","isSubscribed","updateUser","updateUserData","uploadDeviceToken","desactivateUser","Number","desactivatedUser","uploadAvatar","avatarData","file","messazge"],"mappings":"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"}