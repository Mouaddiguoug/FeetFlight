{"version":3,"sources":["../../src/controllers/users.controller.ts"],"sourcesContent":["import { NextFunction, Request, Response } from 'express';\nimport { CreateUserDto } from '@dtos/users.dto';\nimport { User } from '@interfaces/users.interface';\nimport userService from '@services/users.service';\n\nclass UsersController {\n  public userService = new userService();\n\n  public getUsers = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const findAllUsersData: User[] = await this.userService.findAllUser();\n\n      res.status(200).json({ data: findAllUsersData, message: 'findAll' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public getUserById = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const findOneUserData = await this.userService.findUserById(userId);\n\n      res.status(200).json(findOneUserData);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public generateAiPictures = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const color = req.body.color;\n      const category = req.body.category;\n\n      const generatedPictures = await this.userService.generateAiPictures(color, category);\n      \n\n      res.status(200).json(generatedPictures);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public checkForSale = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const postId = String(req.params.postId);\n      const userId = String(req.params.userId);\n      const plan = String(req.params.plan);\n      const checkedFOrSale = await this.userService.checkForSale(userId, postId);\n      const checkForSubscription = await this.userService.checkForSubscriptionbyUserId(userId, postId, plan);\n\n      console.log(checkForSubscription);\n      res.status(200).json(checkedFOrSale || checkForSubscription);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public getSellerPlans = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const sellerPlans = await this.userService.getSellerPlans(userId);\n\n      res.status(200).json({ data: sellerPlans });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public getFollowedSellers = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const role = String(req.params.role);\n      const followedSellers = await this.userService.getFollowedSellers(userId, role);\n      \n\n      res.status(200).json(followedSellers);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public changePassword = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const email = String(req.params.email);\n      const userData = req.body;\n      const findOneUserData = await this.userService.changePassword(email, userData);\n\n      res.status(200).json({ data: findOneUserData, message: 'findOne' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public emailConfirming = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const token = String(req.params.token);\n      const confirmed = await this.userService.emailConfirming(token);\n\n      res.status(201).redirect(\"/public/views/success_pages/verifyEmailSuccess.html\");\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public buyPost = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const saleData = req.body;\n\n      const boughtPost = await this.userService.buyPosts(userId, saleData);\n\n      res.status(200).json({ url: boughtPost });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public subscribe = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const subscriptionData = req.body;\n\n      const subscribeSssion = await this.userService.subscribe(userId, subscriptionData);\n\n      res.status(200).json(subscribeSssion);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public unlockSentPicture = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const unlockSentPictureData = req.body;\n\n      const unlockSentPictureSession = await this.userService.unlockSentPicture(userId, unlockSentPictureData);\n\n      res.status(200).json(unlockSentPictureSession);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public generateOtp = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const email = String(req.params.email);\n\n      const generatedHash = await this.userService.generateOtp(email);\n\n      res.status(200).json(generatedHash);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public verifyOtp = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const email = String(req.params.email);\n      const otpSettings = req.body;\n\n      const result: any = await this.userService.verifyOtp(otpSettings, email);\n\n      res.status(result.message == \"success\" ? 200 : 400).json(result);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public signOut = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const id = String(req.params.id);\n\n      const result = await this.userService.signOut(id);\n\n      res.status(result ? 200 : 400).json({message: result ? \"You have loged out successfully\" : \"Something went wrong\"})\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public contact = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const contactData = req.body;\n      console.log(contactData);\n      \n      await this.userService.contact(contactData);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public cancelSubscription = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n\n    try {\n      const userId = String(req.params.id);\n      const sellerId = String(req.params.sellerId);\n\n      const canceledSubscription = await this.userService.cancelSubscription(userId, sellerId);\n\n      res.status(200).json({ canceledSubscription: canceledSubscription });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public checkForSubscribtion = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const postId = req.body.data.postId;\n\n      const isSubscribed = await this.userService.checkForSubscription(userId, postId);\n\n      res.status(200).json({ data: isSubscribed });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public updateUser = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n\n      const userData: CreateUserDto = req.body;\n      const updateUserData: User[] = await this.userService.updateUser(userId, userData);\n\n      res.status(200).json({ data: updateUserData, message: 'updated' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public uploadDeviceToken = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n      const token = req.body.token;\n      await this.userService.uploadDeviceToken(userId, token);\n\n      res.status(200).json({ message: 'token uploaded succcessfully' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public desactivateUser = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = Number(req.params.id);\n      const desactivatedUser = await this.userService.desactivateUser(userId);\n\n      res.status(200).json({ data: desactivatedUser });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public uploadAvatar = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userId = String(req.params.id);\n\n      const avatarData = req.file;\n\n      await this.userService.uploadAvatar(avatarData, userId);\n\n      res.status(201).json({ messazge: \"avatar has been uploaded successfully\" });\n    } catch (error) {\n      next(error);\n    }\n  };\n}\n\nexport default UsersController;\n"],"names":["UsersController","userService","getUsers","req","res","next","findAllUsersData","findAllUser","status","json","data","message","error","getUserById","userId","String","params","id","findOneUserData","findUserById","generateAiPictures","color","body","category","generatedPictures","checkForSale","postId","plan","checkedFOrSale","checkForSubscription","checkForSubscriptionbyUserId","console","log","getSellerPlans","sellerPlans","getFollowedSellers","role","followedSellers","changePassword","email","userData","emailConfirming","token","confirmed","redirect","buyPost","saleData","boughtPost","buyPosts","url","subscribe","subscriptionData","subscribeSssion","unlockSentPicture","unlockSentPictureData","unlockSentPictureSession","generateOtp","generatedHash","verifyOtp","otpSettings","result","signOut","contact","contactData","cancelSubscription","sellerId","canceledSubscription","checkForSubscribtion","isSubscribed","updateUser","updateUserData","uploadDeviceToken","desactivateUser","Number","desactivatedUser","uploadAvatar","avatarData","file","messazge"],"mappings":"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"}