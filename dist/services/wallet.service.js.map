{"version":3,"sources":["../../src/services/wallet.service.ts"],"sourcesContent":["import { initializeDbConnection } from '@/app';\nimport { int } from 'neo4j-driver';\nimport Stripe from 'stripe';\n\nclass walletService {\n  private stripe = new Stripe(process.env.STRIPE_TEST_KEY, { apiVersion: '2022-11-15' });\n\n  public async getBalance(userId: string) {\n    const getAmountSession = initializeDbConnection().session();\n    try {\n      const walletAmount = await getAmountSession.executeRead(tx =>\n        tx.run('match (w:wallet)<-[:HAS_A]-(s:seller)<-[:IS_A]-(:user {id: $userId}) return w', {\n          userId: userId,\n        }),\n      );\n\n      return walletAmount.records.map(record => record.get('w').properties.amount)[0];\n    } catch (error) {\n      console.log(error);\n    } finally {\n      getAmountSession.close();\n    }\n  }\n\n  public async UpdateBalanceForPayment(sellerId: string, balanceAmount: any) {\n    const updateAmountSession = initializeDbConnection().session();\n    try {\n      console.log(balanceAmount);\n      \n      await updateAmountSession.executeWrite(tx =>\n        tx.run('match (w:wallet)<-[:HAS_A]-(s:seller {id: $sellerId}) set w.amount = w.amount + $newAmount', {\n          newAmount: Number(balanceAmount) - ((Number(balanceAmount) * 20)/100),\n          sellerId: sellerId,\n        }),\n      );\n    } catch (error) {\n      console.log(error);\n    } finally {\n      updateAmountSession.close();\n    }\n  }\n\n  public async UpdateBalanceForSubscription(sellerId: string, balanceAmount: any) {\n    const updateAmountSession = initializeDbConnection().session();\n    try {\n      console.log(sellerId);\n      const updatedAmount = await updateAmountSession.executeWrite(tx =>\n        tx.run('match (w:wallet)<-[:HAS_A]-(s:seller {id: $sellerId}) set w.amount = w.amount + $newAmount return w', {\n          newAmount: Number(balanceAmount) - ((Number(balanceAmount) * 30)/100),\n          sellerId: sellerId,\n        }),\n      );\n\n      return updatedAmount.records.map(record => record.get('w').properties.amount)[0].low; \n    } catch (error) {\n      console.log(error);\n    } finally {\n      updateAmountSession.close();\n    }\n  }\n}\n\nexport default walletService;\n"],"names":["walletService","getBalance","userId","getAmountSession","initializeDbConnection","session","walletAmount","executeRead","tx","run","records","map","record","get","properties","amount","error","console","log","close","UpdateBalanceForPayment","sellerId","balanceAmount","updateAmountSession","executeWrite","newAmount","Number","UpdateBalanceForSubscription","updatedAmount","low","stripe","Stripe","process","env","STRIPE_TEST_KEY","apiVersion"],"mappings":";;;;+BA8DA;;;eAAA;;;qBA9DuC;+DAEpB;;;;;;;;;;;;;;;;;;;AAEnB,IAAA,AAAMA,gBAAN,MAAMA;IAGJ,MAAaC,WAAWC,MAAc,EAAE;QACtC,MAAMC,mBAAmBC,IAAAA,2BAAsB,IAAGC,OAAO;QACzD,IAAI;YACF,MAAMC,eAAe,MAAMH,iBAAiBI,WAAW,CAACC,CAAAA,KACtDA,GAAGC,GAAG,CAAC,iFAAiF;oBACtFP,QAAQA;gBACV;YAGF,OAAOI,aAAaI,OAAO,CAACC,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG,CAAC,KAAKC,UAAU,CAACC,MAAM,CAAC,CAAC,EAAE;QACjF,EAAE,OAAOC,OAAO;YACdC,QAAQC,GAAG,CAACF;QACd,SAAU;YACRb,iBAAiBgB,KAAK;QACxB;IACF;IAEA,MAAaC,wBAAwBC,QAAgB,EAAEC,aAAkB,EAAE;QACzE,MAAMC,sBAAsBnB,IAAAA,2BAAsB,IAAGC,OAAO;QAC5D,IAAI;YACFY,QAAQC,GAAG,CAACI;YAEZ,MAAMC,oBAAoBC,YAAY,CAAChB,CAAAA,KACrCA,GAAGC,GAAG,CAAC,8FAA8F;oBACnGgB,WAAWC,OAAOJ,iBAAkB,AAACI,OAAOJ,iBAAiB,KAAI;oBACjED,UAAUA;gBACZ;QAEJ,EAAE,OAAOL,OAAO;YACdC,QAAQC,GAAG,CAACF;QACd,SAAU;YACRO,oBAAoBJ,KAAK;QAC3B;IACF;IAEA,MAAaQ,6BAA6BN,QAAgB,EAAEC,aAAkB,EAAE;QAC9E,MAAMC,sBAAsBnB,IAAAA,2BAAsB,IAAGC,OAAO;QAC5D,IAAI;YACFY,QAAQC,GAAG,CAACG;YACZ,MAAMO,gBAAgB,MAAML,oBAAoBC,YAAY,CAAChB,CAAAA,KAC3DA,GAAGC,GAAG,CAAC,uGAAuG;oBAC5GgB,WAAWC,OAAOJ,iBAAkB,AAACI,OAAOJ,iBAAiB,KAAI;oBACjED,UAAUA;gBACZ;YAGF,OAAOO,cAAclB,OAAO,CAACC,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG,CAAC,KAAKC,UAAU,CAACC,MAAM,CAAC,CAAC,EAAE,CAACc,GAAG;QACtF,EAAE,OAAOb,OAAO;YACdC,QAAQC,GAAG,CAACF;QACd,SAAU;YACRO,oBAAoBJ,KAAK;QAC3B;IACF;;QAtDA,uBAAQW,UAAS,IAAIC,eAAM,CAACC,QAAQC,GAAG,CAACC,eAAe,EAAE;YAAEC,YAAY;QAAa;;AAuDtF;MAEA,WAAenC"}