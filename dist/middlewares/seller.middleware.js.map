{"version":3,"sources":["../../src/middlewares/seller.middleware.ts"],"sourcesContent":["import { NextFunction, Response } from 'express';\nimport { verify } from 'jsonwebtoken';\nimport { SECRET_KEY } from '@config';\nimport { HttpException } from '@exceptions/HttpException';\nimport { DataStoredInToken, RequestWithUser } from '@interfaces/auth.interface';\nimport { initializeDbConnection } from '@/app';\nimport { RolesEnum } from '@/enums/RolesEnums';\n\nconst sellerMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\n  const userId = String(req.params.id);\n  \n\n  const isVerifiedSession = initializeDbConnection().session();\n\n  try {\n    var isVerifiedUser = await isVerifiedSession.executeRead(\n      tx => tx.run(\"match (u:user {id: $userId})-[:IS_A]-(s:seller) return u, s\", {\n        userId: userId\n      })\n    )\n\n    console.log(isVerifiedUser.records.map(record => record.get(\"u\").properties.verified)[0]);\n    \n  \n    if (isVerifiedUser.records.map(record => record.get(\"s\")).length > 0) {\n      if(isVerifiedUser.records.map(record => record.get(\"s\").properties.isVerified)[0]){\n        next();\n      } else {\n        next(new HttpException(400, 'this user is not verified yet'));\n      }\n    } else {\n      next(new HttpException(400, 'this user is not a seller'));\n    }\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nexport default sellerMiddleware;\n"],"names":["sellerMiddleware","req","res","next","userId","String","params","id","isVerifiedSession","initializeDbConnection","session","isVerifiedUser","executeRead","tx","run","console","log","records","map","record","get","properties","verified","length","isVerified","HttpException","error"],"mappings":";;;;+BAsCA;;;eAAA;;;+BAnC8B;qBAES;AAGvC,MAAMA,mBAAmB,OAAOC,KAAsBC,KAAeC;IACnE,MAAMC,SAASC,OAAOJ,IAAIK,MAAM,CAACC,EAAE;IAGnC,MAAMC,oBAAoBC,IAAAA,2BAAsB,IAAGC,OAAO;IAE1D,IAAI;QACF,IAAIC,iBAAiB,MAAMH,kBAAkBI,WAAW,CACtDC,CAAAA,KAAMA,GAAGC,GAAG,CAAC,+DAA+D;gBAC1EV,QAAQA;YACV;QAGFW,QAAQC,GAAG,CAACL,eAAeM,OAAO,CAACC,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG,CAAC,KAAKC,UAAU,CAACC,QAAQ,CAAC,CAAC,EAAE;QAGxF,IAAIX,eAAeM,OAAO,CAACC,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG,CAAC,MAAMG,MAAM,GAAG,GAAG;YACpE,IAAGZ,eAAeM,OAAO,CAACC,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG,CAAC,KAAKC,UAAU,CAACG,UAAU,CAAC,CAAC,EAAE,EAAC;gBAChFrB;YACF,OAAO;gBACLA,KAAK,IAAIsB,4BAAa,CAAC,KAAK;YAC9B;QACF,OAAO;YACLtB,KAAK,IAAIsB,4BAAa,CAAC,KAAK;QAC9B;IACF,EAAE,OAAOC,OAAO;QACdX,QAAQC,GAAG,CAACU;IACd;AACF;MAEA,WAAe1B"}